Danpu - MySQL dump tool for PHP
=========

[Packagist](https://packagist.org/packages/rah/danpu) | [Twitter](http://twitter.com/gocom) | [Donate](http://rahforum.biz/donate/danpu) | Master/2.0: [![Build Status](https://travis-ci.org/gocom/danpu.png?branch=master)](https://travis-ci.org/gocom/danpu) Legacy/1.0: [![Build Status](https://travis-ci.org/gocom/danpu.png?branch=1.0)](https://travis-ci.org/gocom/danpu)

Danpu is a dependency-free, cross-platform, portable PHP library for backing up MySQL databases. It has no hard dependencies, and is fit for restricted, shared-hosting environments. It requires nothing more than access to your database, PDO and a directory it can write the backup to. The script is optimized and has low memory-footprint, allowing it to handle even larger databases.

Installing
---------

Using [Composer](http://getcomposer.org):

    $ composer.phar require rah/danpu

Usage
---------

To create a new backup or import one, create a ```Dump``` instance containing your configuration options and feed it to one of the worker classes. All classes throw exceptions on failures.

### Taking a backup

Backups are created by the Export class. The class exports the database to a SQL file. The file is compressed if the target filename ends to a .gz extension.

```php
use Rah\Danpu\Dump;
use Rah\Danpu\Export;

$dump = new Dump;
$dump
    ->file('/path/to/target/dump/file.sql')
    ->dsn('mysql:dbname=database;host=localhost')
    ->user('username')
    ->pass('password')
    ->tmp('/tmp');

new Export($dump);
```

### Importing a backup

Danpu can also import its own backups it has created using the Import class. While the importer works with backups it has made, it doesn't accept freely formatted SQL. The importer is pretty strict about formatting, and expects exactly the same format as generated by Danpu. It expects that values in statements are escaped properly, including newlines, queries have to end to a semicolon and statements preferably should not wrap to multiple lines.

To import a backup, create a new instance of the Import class. It uncompresses any .gz files before importing.

```php
new Rah\Danpu\Import($dump);
```

Where the ```$dump``` would be an instance of Rah\Danpu\Dump.

Changelog
---------

### Version 2.5.0 - 2013/05/22

* Fixed: Database table ignoring.
* Fixed: Importer's decompressor.
* Fixed: Table locking doesn't generate errors if the database doesn't have tables.
* Added: Support for triggers and views.
* Added: Importer supports delimiter keyword.
* Changed: Any SQL error is thrown as exception.

### Version 2.4.0 - 2013/05/16

* Fixed: Makes sure creating the temporary file was successful.
* Added: Adds completed on line to the dump file.
* Added: Option to only dump table structures and no rows.

### Version 2.3.3 - 2013/05/15

* Suggest Zlib, but do not require. Zlib isn't required if the file isn't compressed.

### Version 2.3.2 - 2013/05/14

* Fixed: Define Rah\Danpu\Base::$pdo property as protected.

### Version 2.3.1 - 2013/05/14

* Fixed: Can pass instance of Rah\Danpu\Config to a worker. Rah\Base now correctly hints Rah\Danpu\Config instead of Rah\Danpu\Dump.

### Version 2.3.0 - 2013/05/13

* Fixed: Errors in the given examples. The Rah\Danpu\Dump::temp() should be Rah\Danpu\Dump::tmp().
* Added: Rah\Danpu\Config class. Allows creating dump configs by extending.
* Added: Rah\Danpu\Dump now validates the given configuration option names.
* Added: [PHPunit](http://phpunit.de) tests and [Travis](https://travis-ci.org/gocom/danpu).

### Version 2.2.0 - 2013/05/13

* Added: Database connection details are set using a DSN string. Deprecates Rah\Danpu\Dump::$db and Rah\Danpu\Dump::$host.

### Version 2.1.1 - 2013/05/13

* Fixed: Catch PDOExcepiton.

### Version 2.1.0 - 2013/05/13

* Added: Option to ignore database tables.

### Version 2.0.1 - 2013/05/11

* Fixed: Error in the composer.json.

### Version 2.0.0 - 2013/05/11

* Initial release.